<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>لوحة اللاعبين – نادي كلباء</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body{font-family:"Noto Kufi Arabic",sans-serif}</style>
</head>
<body class="bg-gray-50">
  <header class="bg-black text-yellow-300">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-xl font-semibold">لوحة إدارة اللاعبين</h1>
      <nav class="flex gap-4 text-sm">
        <a class="hover:text-white" href="#">الرئيسية</a>
        <a class="hover:text-white" href="#add">إضافة لاعب</a>
        <a class="hover:text-white" href="#list">القائمة</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <section id="add" class="bg-white rounded-2xl shadow p-5 mb-6">
      <h2 class="text-lg font-semibold mb-4">إضافة لاعب</h2>
      <form id="playerForm" class="grid sm:grid-cols-2 gap-4">
        <input class="border rounded-lg p-3" name="id" placeholder="الرقم التعريفي (مثال KSC000001)" required>
        <input class="border rounded-lg p-3" name="name" placeholder="الاسم" required>
        <input type="number" min="5" max="70" class="border rounded-lg p-3" name="age" placeholder="العمر" required>
        <input class="border rounded-lg p-3" name="position" placeholder="المركز">
        <input class="border rounded-lg p-3 sm:col-span-2" name="phone" placeholder="الهاتف">
        <button class="bg-yellow-300 hover:bg-yellow-400 text-black rounded-xl py-3 font-semibold sm:col-span-2">حفظ</button>
      </form>
      <p id="saveMsg" class="text-sm text-green-600 mt-3 hidden">تم الحفظ ✅</p>
    </section>

    <section id="list" class="bg-white rounded-2xl shadow p-5">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4">
        <h2 class="text-lg font-semibold">قائمة اللاعبين</h2>
        <input id="search" class="border rounded-lg p-3 w-full sm:w-64" placeholder="ابحث بالاسم أو الرقم">
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm rtl">
          <thead class="bg-gray-100">
            <tr>
              <th class="p-3 text-right">الرقم</th>
              <th class="p-3 text-right">الاسم</th>
              <th class="p-3 text-right">العمر</th>
              <th class="p-3 text-right">المركز</th>
              <th class="p-3 text-right">الهاتف</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <p id="empty" class="text-center text-gray-500 py-6 hidden">لا توجد بيانات حتى الآن</p>
    </section>
  </main>

  <script>
    const API = "https://script.google.com/macros/s/AKfycbwP4Q4XoRYvtSwFWDmY5YnUQ-lCl64hfAZLmaQXYmMq5FOi4KqFLodL025zTciLYRcx/exec";

    async function load() {
      const res = await fetch(API);
      const data = await res.json();
      render(data);
      window._data = data;
    }

    function render(data) {
      const q = (document.getElementById('search').value || '').trim().toLowerCase();
      const filtered = data.filter(r =>
        !q || (r.name||'').toLowerCase().includes(q) || (r.id||'').toLowerCase().includes(q)
      );
      const tb = document.getElementById('rows');
      tb.innerHTML = '';
      if (!filtered.length) document.getElementById('empty').classList.remove('hidden');
      else document.getElementById('empty').classList.add('hidden');
      for (const r of filtered) {
        const tr = document.createElement('tr');
        tr.className = "border-b";
        tr.innerHTML = `
          <td class="p-3">${r.id||''}</td>
          <td class="p-3">${r.name||''}</td>
          <td class="p-3">${r.age||''}</td>
          <td class="p-3">${r.position||''}</td>
          <td class="p-3">${r.phone||''}</td>
        `;
        tb.appendChild(tr);
      }
    }

    document.getElementById('playerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const payload = Object.fromEntries(fd.entries());
      const res = await fetch(API, {method:'POST', body: JSON.stringify(payload)});
      if (res.ok) {
        e.target.reset();
        document.getElementById('saveMsg').classList.remove('hidden');
        setTimeout(()=>document.getElementById('saveMsg').classList.add('hidden'), 1500);
        load();
      } else alert('خطأ في الحفظ');
    });

    document.getElementById('search').addEventListener('input', () => render(window._data||[]));
    load();
  </script>
</body>
</html>
